package pl.widawski.dao;

import java.util.List;

import javax.persistence.EntityManager;
import javax.persistence.EntityManagerFactory;
import javax.persistence.EntityTransaction;
import javax.persistence.Persistence;

import pl.widawski.emp.Employee;

public class EmployeeDAO {
	private EntityManager em;
	private EntityTransaction et;
	public EmployeeDAO(){
		this.em = DBConfig.getEntityManagerFactory().createEntityManager();
		//this.et = em.getTransaction();
	}
	public List<Employee> getEmps() {
		List<Employee> empsList = em.createQuery("Select e from Employee e").getResultList();
		return empsList;
	}
	public List<Employee> getTest() {
		List<Employee> empsList = em.createQuery("Select loop from Employee loop WHERE firstName='Tomek'").getResultList();
		return empsList;
	}
	public int deleteEmp(int id) {
		EntityManagerFactory emf = Persistence.createEntityManagerFactory("CRUDEmployeesApp");
		EntityManager em2 = emf.createEntityManager();
		EntityTransaction et = em2.getTransaction();
		et.begin();
		try {
			int deletedCount = em2.createQuery("delete from Employee WHERE id= :id").executeUpdate();
			et.commit();
			
		}catch(Throwable t) {
			if (et.isActive())
				et.rollback();
		}
		em.close();
		emf.close();
		return id;
		
		

	}
}
